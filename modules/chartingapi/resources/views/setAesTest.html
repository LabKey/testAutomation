<div id="buttons">
    <input type="button" id="next-btn" name="next-btn" onclick="nextChart();" value="Next" />
    <input type="button" id="set-aes-btn" name="set-aes-btn" onclick="setAes();" value="setAes" />
</div>
<div id="testDiv"></div>
<script type="text/javascript">
    var data = {"schemaName":"study","queryName":"Lab Results","formatVersion":9.1,"metaData":{"id":"lsid","title":"Lab Results","totalProperty":"rowCount","importTemplates":[{"label":"Download Template","url":"/labkey/query/Demo/exportExcelTemplate.view?schemaName=study&query.queryName=Lab%20Results&captionType=Name"}],"root":"rows","description":"Contains up to one row of Lab Results data for each Participant/Date combination.","importMessage":null,"fields":[{"ext":{},"name":"ParticipantId/Gender","friendlyType":"Text (String)","type":"string","jsonType":"string","sqlType":"VARCHAR","defaultValue":null,"fieldKey":"ParticipantId/Gender","fieldKeyArray":["ParticipantId","Gender"],"fieldKeyPath":"ParticipantId/Gender","isAutoIncrement":false,"autoIncrement":false,"isHidden":false,"hidden":false,"isKeyField":false,"keyField":false,"isMvEnabled":false,"mvEnabled":false,"isNullable":true,"nullable":true,"isReadOnly":false,"readOnly":false,"isUserEditable":false,"userEditable":false,"calculated":true,"isVersionField":false,"versionField":false,"isSelectable":true,"selectable":true,"shownInInsertView":false,"shownInUpdateView":false,"shownInDetailsView":true,"dimension":false,"measure":false,"protected":false,"excludeFromShifting":false,"conceptURI":null,"inputType":"text","shortCaption":"Gender","facetingBehaviorType":"AUTOMATIC","caption":"Gender"},{"ext":{},"name":"Lymphocytes","friendlyType":"Integer","type":"int","jsonType":"int","sqlType":"int4","defaultValue":null,"fieldKey":"Lymphocytes","fieldKeyArray":["Lymphocytes"],"fieldKeyPath":"Lymphocytes","isAutoIncrement":false,"autoIncrement":false,"isHidden":false,"hidden":false,"isKeyField":false,"keyField":false,"isMvEnabled":false,"mvEnabled":false,"isNullable":true,"nullable":true,"isReadOnly":false,"readOnly":false,"isUserEditable":true,"userEditable":true,"calculated":false,"isVersionField":false,"versionField":false,"isSelectable":true,"selectable":true,"shownInInsertView":true,"shownInUpdateView":true,"shownInDetailsView":true,"dimension":false,"measure":true,"protected":false,"excludeFromShifting":false,"conceptURI":null,"inputType":"text","shortCaption":"Lymphs (cells/mm3)","facetingBehaviorType":"AUTOMATIC","caption":"Lymphs (cells/mm3)"},{"ext":{},"name":"ParticipantId","description":"Subject identifier","friendlyType":"Text (String)","type":"string","jsonType":"string","sqlType":"varchar","defaultValue":null,"fieldKey":"ParticipantId","fieldKeyArray":["ParticipantId"],"fieldKeyPath":"ParticipantId","isAutoIncrement":false,"autoIncrement":false,"isHidden":false,"hidden":false,"isKeyField":false,"keyField":false,"isMvEnabled":false,"mvEnabled":false,"isNullable":false,"nullable":false,"isReadOnly":false,"readOnly":false,"isUserEditable":true,"userEditable":true,"calculated":false,"isVersionField":false,"versionField":false,"isSelectable":true,"selectable":true,"shownInInsertView":true,"shownInUpdateView":true,"shownInDetailsView":true,"dimension":true,"measure":false,"protected":false,"excludeFromShifting":false,"conceptURI":null,"importAliases":["ptid"],"inputType":"text","shortCaption":"Participant ID","facetingBehaviorType":"AUTOMATIC","caption":"Participant ID","lookup":{"keyColumn":"ParticipantId","schema":"study","displayColumn":"ParticipantId","schemaName":"study","queryName":"Participant","table":"Participant","isPublic":true,"public":true}},{"ext":{},"name":"CD4","friendlyType":"Integer","type":"int","jsonType":"int","sqlType":"int4","defaultValue":null,"fieldKey":"CD4","fieldKeyArray":["CD4"],"fieldKeyPath":"CD4","isAutoIncrement":false,"autoIncrement":false,"isHidden":false,"hidden":false,"isKeyField":false,"keyField":false,"isMvEnabled":false,"mvEnabled":false,"isNullable":true,"nullable":true,"isReadOnly":false,"readOnly":false,"isUserEditable":true,"userEditable":true,"calculated":false,"isVersionField":false,"versionField":false,"isSelectable":true,"selectable":true,"shownInInsertView":true,"shownInUpdateView":true,"shownInDetailsView":true,"dimension":false,"measure":true,"protected":false,"excludeFromShifting":false,"conceptURI":null,"inputType":"text","shortCaption":"CD4+ (cells/mm3)","facetingBehaviorType":"AUTOMATIC","caption":"CD4+ (cells/mm3)"},{"ext":{},"name":"lsid","friendlyType":"Text (String)","type":"string","jsonType":"string","sqlType":"varchar","defaultValue":null,"fieldKey":"lsid","fieldKeyArray":["lsid"],"fieldKeyPath":"lsid","isAutoIncrement":false,"autoIncrement":false,"isHidden":true,"hidden":true,"isKeyField":true,"keyField":true,"isMvEnabled":false,"mvEnabled":false,"isNullable":false,"nullable":false,"isReadOnly":false,"readOnly":false,"isUserEditable":false,"userEditable":false,"calculated":false,"isVersionField":false,"versionField":false,"isSelectable":true,"selectable":true,"shownInInsertView":false,"shownInUpdateView":false,"shownInDetailsView":true,"dimension":false,"measure":false,"protected":false,"excludeFromShifting":false,"conceptURI":null,"inputType":"text","shortCaption":"Lsid","facetingBehaviorType":"AUTOMATIC","caption":"Lsid"}]},"columnModel":[{"scale":0,"hidden":false,"width":10,"align":"left","sortable":true,"dataIndex":"ParticipantId/Gender","required":false,"header":"Gender","editable":false},{"scale":10,"hidden":false,"width":60,"align":"right","sortable":true,"dataIndex":"Lymphocytes","required":false,"header":"Lymphs (cells/mm3)","editable":true},{"scale":32,"hidden":false,"width":10,"align":"left","sortable":true,"dataIndex":"ParticipantId","required":true,"header":"Participant ID","editable":true,"tooltip":"Subject identifier"},{"scale":10,"hidden":false,"width":60,"align":"right","sortable":true,"dataIndex":"CD4","required":false,"header":"CD4+ (cells/mm3)","editable":true},{"scale":200,"hidden":true,"width":10,"align":"left","sortable":true,"dataIndex":"lsid","required":true,"header":"Lsid","editable":false}],"rows":[{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":-1},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1222},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080429.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1224},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1235},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080430.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":772},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1123},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080528.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":390},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1271},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080625.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":317},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1169},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080723.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":271},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1039},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080820.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":327},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1234},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20080917.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":271},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1080},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20081015.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":567},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1081},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20081112.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1020},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":882},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20081210.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1022},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":736},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090107.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1008},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1095},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090304.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1024},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1039},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090401.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":801},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1173},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090429.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1005},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1236},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090527.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1192},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1341},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090624.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":937},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1396},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090722.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1034},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1431},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090819.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":1005},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1372},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20090916.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":688},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1481},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20091014.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":764},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1672},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20091111.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":405},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1851},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20091209.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":223},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1722},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20100106.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":843},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1879},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20100203.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":462},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":2061},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20100303.0000"}},{"ParticipantId":{"value":"103866","url":"/labkey/study/Demo/participant.view?participantId=103866"},"CD4":{"value":701},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1974},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.103866.20100331.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1390},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":978},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080429.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1457},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":974},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080527.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":821},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1160},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080624.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":517},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1310},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080722.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":295},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1392},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080819.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1076},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1523},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20080916.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1342},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1464},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20081014.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":877},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1615},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20081111.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":475},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1579},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20081209.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":736},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1660},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090106.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":434},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1768},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090203.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":272},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1954},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090303.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":391},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1803},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090331.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":725},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1848},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090428.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":459},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1798},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090526.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1182},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1743},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090721.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1493},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1615},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090818.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":764},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1626},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20090915.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":609},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1747},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20091013.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":625},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1635},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20091110.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":400},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1806},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20091208.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":950},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1952},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20100105.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":916},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":2105},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20100202.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":542},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1927},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20100302.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1090},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":2049},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20100330.0000"}},{"ParticipantId":{"value":"110349","url":"/labkey/study/Demo/participant.view?participantId=110349"},"CD4":{"value":1283},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":2108},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.110349.20100427.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":239},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1802},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080420.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":266},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1787},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080518.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":224},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1843},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080615.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":163},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1780},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080713.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":432},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1859},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080810.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":954},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2017},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20080907.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":1044},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2185},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20081005.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":1094},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2054},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20081102.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":1028},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2085},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20081130.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":962},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2099},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20081228.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":652},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":2121},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090125.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":386},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1975},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090222.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":653},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1870},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090322.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":530},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1953},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090419.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":366},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1777},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090517.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":426},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1830},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090614.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":360},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1668},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090712.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":467},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1620},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090809.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":525},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1752},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20090906.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":351},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1551},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20091004.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":379},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1406},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20091101.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":594},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1397},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20091129.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":513},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1587},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20091227.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":546},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1759},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20100124.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":537},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1686},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20100221.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":279},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1609},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20100321.0000"}},{"ParticipantId":{"value":"119180","url":"/labkey/study/Demo/participant.view?participantId=119180"},"CD4":{"value":226},"ParticipantId/Gender":{"value":"Females"},"Lymphocytes":{"value":1707},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.119180.20100418.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":1190},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":1141},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080428.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":757},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":999},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080526.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":428},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":937},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080623.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":291},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":825},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080721.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":154},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":882},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080818.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":157},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":949},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20080915.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":121},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":789},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20081013.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":108},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":692},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20081110.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":108},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":791},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20081208.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":148},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":966},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090105.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":101},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":922},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090202.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":523},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":965},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090302.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":690},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":877},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090330.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":681},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":770},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090427.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":727},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":784},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090525.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":741},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":896},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090622.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":451},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":780},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090720.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":524},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":970},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090817.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":749},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":802},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20090914.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":539},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":870},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20091012.0000"}},{"ParticipantId":{"value":"125478","url":"/labkey/study/Demo/participant.view?participantId=125478"},"CD4":{"value":340},"ParticipantId/Gender":{"value":"Males"},"Lymphocytes":{"value":821},"lsid":{"value":"urn:lsid:labkey.com:Study.Data-10176:5007.125478.20091109.0000"}}],"rowCount":2691};
    var lpData = [{"name":"Alan","day":0,"value":70},{"name":"Trey","day":0,"value":39},{"name":"Nick","day":0,"value":75},{"name":"Alan","day":1,"value":43},{"name":"Trey","day":1,"value":13},{"name":"Nick","day":1,"value":59},{"name":"Alan","day":2,"value":43},{"name":"Trey","day":2,"value":95},{"name":"Nick","day":2,"value":34},{"name":"Alan","day":3,"value":63},{"name":"Trey","day":3,"value":100},{"name":"Nick","day":3,"value":69},{"name":"Alan","day":4,"value":35},{"name":"Trey","day":4,"value":69},{"name":"Nick","day":4,"value":42},{"name":"Alan","day":5,"value":88},{"name":"Trey","day":5,"value":24},{"name":"Nick","day":5,"value":67},{"name":"Alan","day":6,"value":31},{"name":"Trey","day":6,"value":75},{"name":"Nick","day":6,"value":39},{"name":"Alan","day":7,"value":37},{"name":"Trey","day":7,"value":96},{"name":"Nick","day":7,"value":78},{"name":"Alan","day":8,"value":19},{"name":"Trey","day":8,"value":59},{"name":"Nick","day":8,"value":13},{"name":"Alan","day":9,"value":41},{"name":"Trey","day":9,"value":95},{"name":"Nick","day":9,"value":60},{"name":"Alan","day":10,"value":2},{"name":"Trey","day":10,"value":33},{"name":"Nick","day":10,"value":78},{"name":"Alan","day":11,"value":88},{"name":"Trey","day":11,"value":85},{"name":"Nick","day":11,"value":64},{"name":"Alan","day":12,"value":3},{"name":"Trey","day":12,"value":57},{"name":"Nick","day":12,"value":64},{"name":"Alan","day":13,"value":5},{"name":"Trey","day":13,"value":44},{"name":"Nick","day":13,"value":26},{"name":"Alan","day":14,"value":9},{"name":"Trey","day":14,"value":96},{"name":"Nick","day":14,"value":26},{"name":"Alan","day":15,"value":94},{"name":"Trey","day":15,"value":14},{"name":"Nick","day":15,"value":34},{"name":"Alan","day":16,"value":42},{"name":"Trey","day":16,"value":47},{"name":"Nick","day":16,"value":8},{"name":"Alan","day":17,"value":73},{"name":"Trey","day":17,"value":76},{"name":"Nick","day":17,"value":41},{"name":"Alan","day":18,"value":28},{"name":"Trey","day":18,"value":2},{"name":"Nick","day":18,"value":46},{"name":"Alan","day":19,"value":41},{"name":"Trey","day":19,"value":14},{"name":"Nick","day":19,"value":93},{"name":"Alan","day":20,"value":11},{"name":"Trey","day":20,"value":33},{"name":"Nick","day":20,"value":73},{"name":"Alan","day":21,"value":58},{"name":"Trey","day":21,"value":16},{"name":"Nick","day":21,"value":12},{"name":"Alan","day":22,"value":37},{"name":"Trey","day":22,"value":48},{"name":"Nick","day":22,"value":19},{"name":"Alan","day":23,"value":80},{"name":"Trey","day":23,"value":83},{"name":"Nick","day":23,"value":53},{"name":"Alan","day":24,"value":98},{"name":"Trey","day":24,"value":99},{"name":"Nick","day":24,"value":87}];
    var charts = []; // an array of plot objects.
    var aesthetics = []; // an array of layer indices and aes objects.
    var chartIdx = 0;
    var nextChart = function(){
        chartIdx = chartIdx + 1;

        if(chartIdx == charts.length - 1) {
            document.getElementById('next-btn').setAttribute('disabled', 'true');
        }

        document.getElementById('testDiv').innerHTML = '';

        var chartConfig = charts[chartIdx];
        charts[chartIdx].render();
    };
    var setAes = function(){
        var aes = aesthetics[chartIdx].aes;
        var aesIdx = aesthetics[chartIdx].idx;
        var chart = charts[chartIdx];

        // Gotta test both layer level and plot level setAes functions.
        if(aesIdx > -1) {
            chart.layers[aesIdx].setAes(aes);
        } else {
            chart.setAes(aes);
        }
    };

    LABKEY.requiresVisualization(function(){
        // Changes outlier color and shape.
        var boxPlot = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Box Plot - Change outlier color/shape'}
            },
            data: data.rows,
            layers: [new LABKEY.vis.Layer({
                geom: new LABKEY.vis.Geom.Boxplot({})
            })],
            aes: {
                x: function(d){return d.ParticipantId.value;},
                yLeft: function(d){return d.CD4.value;}
            },
            scales: {
                x: {scaleType: 'discrete'},
                yLeft: {scaleType: 'continuous',trans: 'linear'}
            }
        });
        charts.push(boxPlot);
        aesthetics.push({idx: -1, aes: {
            outlierColor: function(d){return d.ParticipantId.value},
            outlierShape: function(d){return d['ParticipantId/Gender'].value}
        }});

        // Changes color, shape, and x axis.
        var scatterPlot = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Scatter - add shape/color change x'}
            },
            data: data.rows,
            layers: [new LABKEY.vis.Layer({
                geom: new LABKEY.vis.Geom.Point({}),
                aes: {x: function(d){return d.Lymphocytes.value;}}
            })],
            aes: {
                yLeft: function(d){return d.CD4.value;}
            },
            scales: {
                x: {scaleType: 'continuous', trans: 'linear'},
                yLeft: {scaleType: 'continuous', trans: 'linear'}
            }
        });
        charts.push(scatterPlot);
        aesthetics.push({idx: 0, aes: {
            color: function(d){return d.ParticipantId.value},
            shape: function(d){return d['ParticipantId/Gender'].value},
            x: function(d){return d.CD4.value;}
        }});

        // Removes hoverText and changes pointClickFn;
        var scatterPlotWithHoverAndClick = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Scatter with hover and click'}
            },
            data: data.rows,
            layers: [new LABKEY.vis.Layer({
                geom: new LABKEY.vis.Geom.Point({})
            })],
            aes: {
                x: function(d){return d.CD4.value;},
                yLeft: function(d){return d.Lymphocytes.value;},
                hoverText: function(d){return "HOVER TEXT"},
                pointClickFn: function(d){LABKEY.Utils.alert('Click Handler', 'Look a click handler!');}
            },
            scales: {
                x: {scaleType: 'continuous', trans: 'linear'},
                yLeft: {scaleType: 'continuous', trans: 'linear'}
            }
        });
        charts.push(scatterPlotWithHoverAndClick);
        aesthetics.push({idx: -1, aes: {
            hoverText: null,
            pointClickFn: function(d){LABKEY.Utils.alert('New Click Handler', 'The click handler has changed!');}
        }});

        // Here we add a color aesthetic to the line layer, and change the yLeft aesthetic function. The errorbar layer
        // should be unaffected.
        var lineErrorPlot = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Line/Error - Add color, change Y'}
            },
            data: lpData,
            layers: [
                new LABKEY.vis.Layer({
                    geom: new LABKEY.vis.Geom.Path({})
                }),
                new LABKEY.vis.Layer({
                    geom: new LABKEY.vis.Geom.ErrorBar({})
                })],
            aes: {
                x: function(d){
                    return d.day;
                },
                group: function(d) {
                    return d.name;
                },
                yLeft: function(d){
                    return d.value;
                },
                error: function(d) {
                    return 3;
                }
            },
            scales: {
                x: {scaleType: 'continuous', trans: 'linear'},
                yLeft: {scaleType: 'continuous', trans: 'linear'}
            }
        });
        charts.push(lineErrorPlot);
        aesthetics.push({idx: 0, aes: {
            pathColor: 'name',
            y: function(d) {return Math.log(d.value);}
        }});

        // Removes the shape aes, which in turn removes the legend. Test case for Issue 19351.
        var scatterPlotRemoveLegend = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Scatter remove legend'}
            },
            data: data.rows,
            layers: [new LABKEY.vis.Layer({
                geom: new LABKEY.vis.Geom.Point({})
            })],
            aes: {
                x: function(d){return d.CD4.value;},
                yLeft: function(d){return d.Lymphocytes.value;},
                shape: function(d){return d.ParticipantId.value}
            },
            scales: {
                x: {scaleType: 'continuous', trans: 'linear'},
                yLeft: {scaleType: 'continuous', trans: 'linear'}
            }
        });
        charts.push(scatterPlotRemoveLegend);
        aesthetics.push({idx: -1, aes: {shape: null}});

        var generateDataForPTID = function(id) {
            var data = [];

            // Step one: generate data for bottom left of chart.
            for (var i = 0; i < 10; i++) {
                data.push({
                    ptid: id,
                    x: (i * 15) + 50,
                    y: (id * 22) + 25
                });
            }
            // Step two: generate data for top right of chart.
            for (var i = 0; i < 10; i++) {
                data.push({
                    ptid: id,
                    x: (i * 15) + 500,
                    y: (id * 22) + 500
                });
            }

            return data;
        };

        var brushedData = [];

        for (var i = 0; i < 20; i++) {
            brushedData = brushedData.concat(generateDataForPTID(i));
        }

        // Tests brushing functionality and custom scales.
        // Tests Issue 19455: JS error when mouseOutFn aes is removed via setAes call
        var brushed = false;
        var scatterPlotBrushing = new LABKEY.vis.Plot({
            renderTo: 'testDiv',
            rendererType: 'd3',
            width: 900,
            height: 500,
            labels: {
                main: {value: 'Scatter With Brushing and Custom Scales'}
            },
            data: brushedData,
            layers: [new LABKEY.vis.Layer({
                geom: new LABKEY.vis.Geom.Point({})
            })],
            aes: {
                x: 'x',
                yLeft: 'y',
                shape: 'ptid',
                color: 'ptid',
                mouseOverFn: function(event, data, layerSel) {
                    if (brushed) {return;}
                    var points = layerSel.selectAll('.point path');
                    var colorScale = scatterPlotBrushing.scales.color.scale;
                    var fillAcc = function(d) {
                        if (d.ptid == data.ptid) {
                            return '#01BFC2'
                        }
                        return colorScale(d.ptid);
                    };
                    var strokeAcc = function(d) {
                        if (d.ptid == data.ptid) {
                            return '#00EAFF';
                        }
                        return colorScale(d.ptid);
                    };

                    points.attr('fill', fillAcc).attr('stroke', strokeAcc);
                },
                mouseOutFn: function(event, data, layerSel) {
                    if (brushed) {return;}
                    var points = layerSel.selectAll('.point path');
                    var colorScale = scatterPlotBrushing.scales.color.scale;
                    var fillAcc = function(d) {
                        return colorScale(d.ptid);
                    };
                    var strokeAcc = function(d) {
                        return colorScale(d.ptid);
                    };

                    points.attr('fill', fillAcc).attr('stroke', strokeAcc);
                }
            },
            scales: {
                x: {scaleType: 'continuous', trans: 'linear', domain: [0, null]},
                yLeft: {scaleType: 'continuous', trans: 'linear', domain: [0, null]},
                color: {scaleType: 'discrete', range: LABKEY.vis.Scale.DataspaceColor()},
                shape: {scaleType: 'discrete', range: LABKEY.vis.Scale.DataspaceShape()}
            },
            brushing: {
                brushstart: function(event, data, extent, plot, layerSelections) {
                    brushed = true;
                },
                brush: function(event, data, extent, plot, layerSelections) {
                    var points = layerSelections[0].selectAll('.point path');
                    var colorScale = scatterPlotBrushing.scales.color.scale;
                    var colorAcc = function(d) {
                        var x = d.x, y = d.y;
                        d.isSelected = (x > extent[0][0] && x < extent[1][0] && y > extent[0][1] && y < extent[1][1])
                        if (d.isSelected) {
                            return '#14C9CC';
                        }
                        return colorScale(d.ptid);
                    };
                    var strokeAcc = function(d) {
                        if (d.isSelected){
                            return '#00393A';
                        } else {
                            return colorScale(d.ptid);
                        }
                    };
                    var strokeWidthAcc = function(d) {
                        if (d.isSelected){
                            return .5;
                        } else {
                            return 1;
                        }
                    };
                    points.attr('fill', colorAcc)
                            .attr('stroke', strokeAcc)
                            .attr('stroke-width', strokeWidthAcc);
                }
            }
        });
        charts.push(scatterPlotBrushing);
        aesthetics.push({idx: -1, aes:{mouseOutFn: null, mouseOverFn: null}});

        // Render the first chart.
        charts[chartIdx].render();
    });
</script>