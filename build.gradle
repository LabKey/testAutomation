apply plugin: 'java'
apply plugin: 'org.labkey.testRunner'

import org.labkey.gradle.util.BuildUtils

project.dependencies {
    implementation "org.slf4j:slf4j-log4j12:${slf4jLog4j12Version}" // Suppresses unwanted logging from remoteapi and webdriver
    implementation "com.github.lookfirst:sardine:${project.lookfirstSardineVersion}"
    implementation "com.googlecode.json-simple:json-simple:${jsonSimpleVersion}"
    implementation "javax.xml.bind:jaxb-api:${jaxbVersion}"
    implementation "com.sun.xml.bind:jaxb-impl:${jaxbVersion}"
    implementation "com.sun.xml.bind:jaxb-core:${jaxbVersion}"
    implementation "commons-beanutils:commons-beanutils:${commonsBeanutilsVersion}"
    implementation "org.apache.tika:tika-core:${tikaVersion}"
    implementation "org.apache.commons:commons-compress:${commonsCompressVersion}"
    implementation "org.apache.commons:commons-lang3:${commonsLang3Version}"
    implementation "org.apache.commons:commons-math3:${commonsMath3Version}"
    implementation "org.apache.pdfbox:pdfbox:${pdfboxVersion}"
    implementation "org.apache.poi:poi:${poiVersion}"
    implementation "org.apache.poi:poi-ooxml:${poiVersion}"
    implementation "org.apache.xmlbeans:xmlbeans:${xmlbeansVersion}"
    implementation "org.bouncycastle:bcpg-jdk15on:${bouncycastleVersion}"
    implementation "org.jetbrains:annotations:${annotationsVersion}"
    implementation "org.mock-server:mockserver-netty:${mockserverVersion}"

    if (project.hasProperty("teamcity"))
    {
        // LabKey XML schemas are used to decode exported folder XMLs and test case XMLs
        // Don't include local version so that running tests doesn't require building API module
        implementation("org.labkey.api:api:${labkeySchemasTestVersion}") { transitive = false }
    }
    else
    {
        // Use local version outside of TeamCity so as to not confuse IntelliJ
        implementation(project(BuildUtils.getApiProjectPath(project.gradle))) { transitive = false }
    }

    // Issue 36184: Tests can't find selenium-ie-driver library when running on Windows on TeamCity
    // Workaround to ensure that the class-loader finds InternetExplorerDriver
    implementation "org.seleniumhq.selenium:selenium-ie-driver:${seleniumVersion}"
}

BuildUtils.addLabKeyDependency(
        project: project,
        config: 'uiTestImplementation',
        depProjectPath: BuildUtils.getRemoteApiProjectPath(gradle),
        depProjectConfig: 'default',
        depVersion: project.labkeyVersion)

if (project.findProject(":remoteapi:labkey-api-jdbc") != null)
{
    BuildUtils.addLabKeyDependency(project: project, config: "implementation", depProjectPath: ":remoteapi:labkey-api-jdbc")
}

if (project.hasProperty("teamcity"))
{
    apply plugin: 'org.labkey.teamCity'
}
